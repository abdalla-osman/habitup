name: Build APK

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-apk:
    runs-on: ubuntu-latest

    steps:
      # 1. سحب الكود من الريبو
      - name: Checkout repo
        uses: actions/checkout@v3

      # 2. تثبيت Node 18
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3. تثبيت dependencies
      - name: Install dependencies
        run: npm ci

      # 4. تثبيت EAS CLI
      - name: Install EAS CLI
        run: npm install -g eas-cli@3.34.1

      # 5. تسجيل الدخول باستخدام EXPO_TOKEN
      - name: EAS Login
        run: eas login --token ${{ secrets.EXPO_TOKEN }}

      # 6. تشغيل build للـ APK
      - name: Build APK
        run: eas build -p android --non-interactive --profile production

      # 7. رفع APK كـ artifact لتقدر تحمله
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release
          path: |
            **/*.apk
